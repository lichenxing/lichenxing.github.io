!function(e,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports,require("inferno"),require("stream")):"function"===typeof define&&define.amd?define(["exports","inferno","stream"],r):r(((e="undefined"!==typeof globalThis?globalThis:e||self).Inferno=e.Inferno||{},e.Inferno.Server=e.Inferno.Server||{}),e.Inferno,e.stream)}(this,(function(e,r,t){"use strict";var n="a runtime error occured! Use Inferno in development environment to find the error.",o=Array.isArray;function i(e){return void 0===e||null===e}function u(e){return null===e||!1===e||!0===e||void 0===e}function s(e){return"function"===typeof e}function a(e){return"string"===typeof e}function c(e){return"number"===typeof e}function l(e){return null===e}function f(e){throw e||(e=n),new Error("Inferno Error: "+e)}function d(e,r){var t={};if(e)for(var n in e)t[n]=e[n];if(r)for(var o in r)t[o]=r[o];return t}function h(e){if(a(e))return e;var r,t="";for(var n in e){var o=e[n];("string"===(r=typeof o)||"number"===r)&&(t+=n+":"+o+";")}return t}var p=new RegExp(/["'&<>]/);function v(e){if(!p.test(e))return e;var r,t="",n="",o=0;for(r=0;r<e.length;++r){switch(e.charCodeAt(r)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}r>o&&(t+=e.slice(o,r)),t+=n,o=r+1}return t+e.slice(o,r)}var m=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",g=new RegExp("^["+m+"]["+m+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),y={},T={};function b(e){if(void 0!==T[e])return!0;if(void 0!==y[e])return!1;if(g.test(e))return T[e]=!0,!0;return y[e]=!0,!1}var x=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function Q(e,r,t){if(e.constructor.getDerivedStateFromProps)return d(t,e.constructor.getDerivedStateFromProps(r,t));return t}function S(e,t){var n=e.props||r.EMPTY_OBJ;return 32768&e.flags?e.type.render(n,e.ref,t):e.type(n,t)}function k(e,t,n){var p=e.flags,m=e.type,g=e.props||r.EMPTY_OBJ,y=e.children;if(0!==(14&p)){if(4&p){var T,F=new m(g,n),P=Boolean(m.getDerivedStateFromProps);if(F.$BS=!1,F.$SSR=!0,s(F.getChildContext)&&(T=F.getChildContext()),T=i(T)?n:d(n,T),F.props===r.EMPTY_OBJ&&(F.props=g),F.context=n,!P&&s(F.componentWillMount)){F.$BR=!0,F.componentWillMount(),F.$BR=!1;var C=F.$PS;if(C){var N=F.state;if(null===N)F.state=C;else for(var _ in C)N[_]=C[_];F.$PSS=!1,F.$PS=null}}P&&(F.state=Q(F,g,F.state));var w=F.render(g,F.state,F.context);if(u(w))return"\x3c!--!--\x3e";if(a(w))return v(w);if(c(w))return w+"";return k(w,e,T)}var B=S(e,n);if(u(B))return"\x3c!--!--\x3e";if(a(B))return v(B);if(c(B))return B+"";return k(B,e,n)}if(0!==(481&p)){var M,O="<"+m,$=x.has(m),R=e.className;if(a(R)?O+=' class="'+v(R)+'"':c(R)&&(O+=' class="'+R+'"'),!l(g)){for(var D in g){var E=g[D];switch(D){case"dangerouslySetInnerHTML":M=E.__html;break;case"style":i(g.style)||(O+=' style="'+h(g.style)+'"');break;case"children":case"className":break;case"defaultValue":g.value||(O+=' value="'+(a(E)?v(E):E)+'"');break;case"defaultChecked":g.checked||(O+=' checked="'+E+'"');break;default:b(D)&&(a(E)?O+=" "+D+'="'+v(E)+'"':c(E)?O+=" "+D+'="'+E+'"':!0===E&&(O+=" "+D))}}"option"===m&&"undefined"!==typeof g.value&&g.value===t.props.value&&(O+=" selected")}if($)O+=">";else{O+=">";var I=e.childFlags;if(2===I)O+=k(y,e,n);else if(12&I)for(var V=0,A=y.length;V<A;++V)O+=k(y[V],e,n);else 16===I?O+=""===y?" ":v(y):M&&(O+=M);$||(O+="</"+m+">")}if(String(m).match(/[\s\n\/='"\0<>]/))throw O;return O}if(0!==(16&p))return""===y?" ":v(y);if(o(e)||0!==(8192&p)){var j=e.childFlags;if(2===j||o(e)&&0===e.length)return"\x3c!--!--\x3e";if(12&j||o(e)){for(var W=o(e)?e:y,J="",Y=0,q=W.length;Y<q;++Y)J+=k(W[Y],e,n);return J}}else f();return""}function F(e){return k(e,{},{})}function P(e){var r=e.$PS;if(r){var t=e.state;if(null===t)e.state=r;else for(var n in r)t[n]=r[n];e.$PS=null}e.$BR=!1}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e,r){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},N(e,r)}var _=function(e){var t,n;function p(r){var t;return(t=e.call(this)||this).collector=[1/0],t.promises=[],t.pushQueue=t.pushQueue.bind(C(t)),r&&t.renderVNodeToQueue(r,null,null),t}n=e,(t=p).prototype=Object.create(n.prototype),t.prototype.constructor=t,N(t,n);var m=p.prototype;return m._read=function(){setTimeout(this.pushQueue,0)},m.addToQueue=function(e,r){if(i(r))"string"===typeof e&&this.collector.length-1===0?this.push(e):"string"===typeof e&&"string"===typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var t=this.promises[r].length-1;"string"===typeof this.promises[r][t]&&"string"===typeof e?this.promises[r][t]+=e:this.promises[r].push(e)}},m.pushQueue=function(){var e=this.collector[0];if("string"===typeof e)this.push(e),this.collector.shift();else if(e&&("object"===typeof e||s(e))&&s(e.then)){var r=this;e.then((function(e){var t;(t=r.collector).splice.apply(t,[0,1].concat(r.promises[e])),r.promises[e]=null,setTimeout(r.pushQueue,0)})),this.collector[0]=null}else e===1/0&&this.emit("end")},m.renderVNodeToQueue=function(e,t,n){var p=this,m=e.flags,g=e.type,y=e.props||r.EMPTY_OBJ,T=e.children;if((14&m)>0)if(4&m){var k,F=new g(y,t),C=Boolean(g.getDerivedStateFromProps);if(F.$BS=!1,F.$SSR=!0,void 0!==F.getChildContext&&(k=F.getChildContext()),i(k)||(t=d(t,k)),F.props===r.EMPTY_OBJ&&(F.props=y),F.context=t,!C&&s(F.componentWillMount)&&(F.$BR=!0,F.componentWillMount(),P(F)),s(F.getInitialProps)){var N=F.getInitialProps(F.props,F.context);if(N){if(Promise.resolve(N)===N){var _=this.promises.push([])-1;return void this.addToQueue(N.then((function(e){"object"===typeof e&&(F.props=d(F.props,e));var r=F.render(F.props,F.state,F.context);return u(r)?p.addToQueue("\x3c!--!--\x3e",_):a(r)?p.addToQueue(v(r),_):c(r)?p.addToQueue(r+"",_):p.renderVNodeToQueue(r,F.context,_),setTimeout(p.pushQueue,0),_})),n)}F.props=d(F.props,N)}}C&&(F.state=Q(F,y,F.state));var w=F.render(F.props,F.state,F.context);u(w)?this.addToQueue("\x3c!--!--\x3e",n):a(w)?this.addToQueue(v(w),n):c(w)?this.addToQueue(w+"",n):this.renderVNodeToQueue(w,t,n)}else{var B=S(e,t);u(B)?this.addToQueue("\x3c!--!--\x3e",n):a(B)?this.addToQueue(v(B),n):c(B)?this.addToQueue(B+"",n):this.renderVNodeToQueue(B,t,n)}else if((481&m)>0){var M,O="<"+g,$=x.has(g),R=e.className;if(a(R)?O+=' class="'+v(R)+'"':c(R)&&(O+=' class="'+R+'"'),!l(y))for(var D in y){var E=y[D];switch(D){case"dangerouslySetInnerHTML":M=E.__html;break;case"style":i(y.style)||(O+=' style="'+h(y.style)+'"');break;case"children":case"className":break;case"defaultValue":y.value||(O+=' value="'+(a(E)?v(E):E)+'"');break;case"defaultChecked":y.checked||(O+=' checked="'+E+'"');break;default:b(D)&&(a(E)?O+=" "+D+'="'+v(E)+'"':c(E)?O+=" "+D+'="'+E+'"':!0===E&&(O+=" "+D))}}if(O+=">",String(g).match(/[\s\n\/='"\0<>]/))throw O;if($)this.addToQueue(O,n);else{var I=e.childFlags;if(2===I)return this.addToQueue(O,n),this.renderVNodeToQueue(T,t,n),void this.addToQueue("</"+g+">",n);if(16===I)return this.addToQueue(O,n),this.addToQueue(""===T?" ":v(T+""),n),void this.addToQueue("</"+g+">",n);if(12&I){this.addToQueue(O,n);for(var V=0,A=T.length;V<A;++V)this.renderVNodeToQueue(T[V],t,n);return void this.addToQueue("</"+g+">",n)}if(M)return void this.addToQueue(O+M+"</"+g+">",n);$||this.addToQueue(O+"</"+g+">",n)}}else if((16&m)>0)this.addToQueue(""===T?" ":v(T),n);else if(o(e)||0!==(8192&m)){var j=e.childFlags;if(2===j||o(e)&&0===e.length)this.addToQueue("\x3c!--!--\x3e",n);else if(12&j||o(e)){for(var W=o(e)?e:e.children,J=0,Y=W.length;J<Y;++J)this.renderVNodeToQueue(W[J],t,n);return}}else f()},p}(t.Readable);function w(e){return new _(e)}function B(e,r){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},B(e,r)}var M=Promise.resolve(),O=function(e){var r,t;function n(r){var t;return(t=e.call(this)||this).initNode=void 0,t.started=!1,t.initNode=r,t}t=e,(r=n).prototype=Object.create(t.prototype),r.prototype.constructor=r,B(r,t);var f=n.prototype;return f._read=function(){var e=this;if(this.started)return;this.started=!0,M.then((function(){return e.renderNode(e.initNode,null)})).then((function(){e.push(null)})).catch((function(r){e.emit("error",r)}))},f.renderNode=function(e,r){var t=e.flags;if((14&t)>0)return this.renderComponent(e,r,4&t);if((481&t)>0)return this.renderElement(e,r);if(o(e)||0!==(8192&t))return this.renderArrayOrFragment(e,r);return this.renderText(e)},f.renderArrayOrFragment=function(e,r){var t=this,n=e.childFlags;if(2===n||o(e)&&0===e.length)return this.push("\x3c!--!--\x3e");if(12&n||o(e))return(o(e)?e:e.children).reduce((function(e,n){return e.then((function(){return Promise.resolve(t.renderNode(n,r)).then((function(){return!!(16&n.flags)}))}))}),Promise.resolve(!1))},f.renderComponent=function(e,r,t){var n=this,o=e.type,l=e.props;if(!t){var f=S(e,r);if(u(f))return this.push("\x3c!--!--\x3e");if(a(f))return this.push(v(f));if(c(f))return this.push(f+"");return this.renderNode(f,r)}var h,p=new o(l,r),m=Boolean(o.getDerivedStateFromProps);return p.$BS=!1,p.$SSR=!0,s(p.getChildContext)&&(h=p.getChildContext()),i(h)||(r=d(r,h)),p.context=r,p.$BR=!0,Promise.resolve(!m&&p.componentWillMount&&p.componentWillMount()).then((function(){P(p),m&&(p.state=Q(p,l,p.state));var e=p.render(p.props,p.state,p.context);if(u(e))return n.push("\x3c!--!--\x3e");if(a(e))return n.push(v(e));if(c(e))return n.push(e+"");return n.renderNode(e,r)}))},f.renderChildren=function(e,r,t){var n=this;if(2===t)return this.renderNode(e,r);if(16===t)return this.push(""===e?" ":v(e+""));if(12&t)return e.reduce((function(e,t){return e.then((function(){return Promise.resolve(n.renderNode(t,r)).then((function(){return!!(16&t.flags)}))}))}),Promise.resolve(!1))},f.renderText=function(e){this.push(""===e.children?" ":v(e.children))},f.renderElement=function(e,r){var t,n=this,o=e.type,u=e.props,s="<"+o,f=x.has(o),d=e.className;if(a(d)?s+=' class="'+v(d)+'"':c(d)&&(s+=' class="'+d+'"'),!l(u))for(var p in u){var m=u[p];switch(p){case"dangerouslySetInnerHTML":t=m.__html;break;case"style":i(u.style)||(s+=' style="'+h(u.style)+'"');break;case"children":case"className":break;case"defaultValue":u.value||(s+=' value="'+(a(m)?v(m):m)+'"');break;case"defaultChecked":u.checked||(s+=' checked="'+m+'"');break;default:if(b(p)){a(m)?s+=" "+p+'="'+v(m)+'"':c(m)?s+=" "+p+'="'+m+'"':!0===m&&(s+=" "+p);break}}}if(s+=">",this.push(s),String(o).match(/[\s\n\/='"\0<>]/))throw s;if(f)return;if(t)return this.push(t),void this.push("</"+o+">");var g=e.childFlags;if(1===g)return void this.push("</"+o+">");return Promise.resolve(this.renderChildren(e.children,r,g)).then((function(){n.push("</"+o+">")}))},n}(t.Readable);function $(e){return new O(e)}e.RenderQueueStream=_,e.RenderStream=O,e.renderToStaticMarkup=F,e.renderToString=F,e.streamAsStaticMarkup=$,e.streamAsString=$,e.streamQueueAsStaticMarkup=w,e.streamQueueAsString=w}));
