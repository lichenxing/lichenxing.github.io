"use strict";var e=require("inferno"),r=require("stream"),t="a runtime error occured! Use Inferno in development environment to find the error.",n=Array.isArray;function o(e){var r=typeof e;return"string"===r||"number"===r}function i(e){return void 0===e||null===e}function u(e){return null===e||!1===e||!0===e||void 0===e}function s(e){return"function"===typeof e}function a(e){return"string"===typeof e}function c(e){return"number"===typeof e}function l(e){return null===e}function d(e){return void 0===e}function f(e){throw e||(e=t),new Error("Inferno Error: "+e)}function h(e,r){var t={};if(e)for(var n in e)t[n]=e[n];if(r)for(var o in r)t[o]=r[o];return t}function p(e){if(a(e))return e;var r="";for(var t in e){var n=e[t];o(n)&&(r+=t+":"+n+";")}return r}var v=new RegExp(/["'&<>]/);function m(e){if(!v.test(e))return e;var r,t="",n="",o=0;for(r=0;r<e.length;++r){switch(e.charCodeAt(r)){case 34:n="&quot;";break;case 39:n="&#039;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}r>o&&(t+=e.slice(o,r)),t+=n,o=r+1}return t+e.slice(o,r)}var g=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",y=g+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",x=new RegExp("^["+g+"]["+y+"]*$"),T={},b={};function Q(e){if(void 0!==b[e])return!0;if(void 0!==T[e])return!1;if(x.test(e))return b[e]=!0,!0;return T[e]=!0,!1}var k=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]);function F(e,r,t){if(e.constructor.getDerivedStateFromProps)return h(t,e.constructor.getDerivedStateFromProps(r,t));return t}function S(r,t){var n=r.props||e.EMPTY_OBJ;return 32768&r.flags?r.type.render(n,r.ref,t):r.type(n,t)}function P(r,t,o){var d=r.flags,v=r.type,g=r.props||e.EMPTY_OBJ,y=r.children;if(0!==(14&d)){if(4&d){var x,T=new v(g,o),b=Boolean(v.getDerivedStateFromProps);if(T.$BS=!1,T.$SSR=!0,s(T.getChildContext)&&(x=T.getChildContext()),x=i(x)?o:h(o,x),T.props===e.EMPTY_OBJ&&(T.props=g),T.context=o,!b&&s(T.componentWillMount)){T.$BR=!0,T.componentWillMount(),T.$BR=!1;var C=T.$PS;if(C){var N=T.state;if(null===N)T.state=C;else for(var _ in C)N[_]=C[_];T.$PSS=!1,T.$PS=null}}b&&(T.state=F(T,g,T.state));var w=T.render(g,T.state,T.context);if(u(w))return"\x3c!--!--\x3e";if(a(w))return m(w);if(c(w))return w+"";return P(w,r,x)}var B=S(r,o);if(u(B))return"\x3c!--!--\x3e";if(a(B))return m(B);if(c(B))return B+"";return P(B,r,o)}if(0!==(481&d)){var M,O="<"+v,$=k.has(v),R=r.className;if(a(R)?O+=' class="'+m(R)+'"':c(R)&&(O+=' class="'+R+'"'),!l(g)){for(var D in g){var E=g[D];switch(D){case"dangerouslySetInnerHTML":M=E.__html;break;case"style":i(g.style)||(O+=' style="'+p(g.style)+'"');break;case"children":case"className":break;case"defaultValue":g.value||(O+=' value="'+(a(E)?m(E):E)+'"');break;case"defaultChecked":g.checked||(O+=' checked="'+E+'"');break;default:Q(D)&&(a(E)?O+=" "+D+'="'+m(E)+'"':c(E)?O+=" "+D+'="'+E+'"':!0===E&&(O+=" "+D))}}"option"===v&&"undefined"!==typeof g.value&&g.value===t.props.value&&(O+=" selected")}if($)O+=">";else{O+=">";var V=r.childFlags;if(2===V)O+=P(y,r,o);else if(12&V)for(var A=0,j=y.length;A<j;++A)O+=P(y[A],r,o);else 16===V?O+=""===y?" ":m(y):M&&(O+=M);$||(O+="</"+v+">")}if(String(v).match(/[\s\n\/='"\0<>]/))throw O;return O}if(0!==(16&d))return""===y?" ":m(y);if(n(r)||0!==(8192&d)){var I=r.childFlags;if(2===I||n(r)&&0===r.length)return"\x3c!--!--\x3e";if(12&I||n(r)){for(var W=n(r)?r:y,J="",Y=0,q=W.length;Y<q;++Y)J+=P(W[Y],r,o);return J}}else f();return""}function C(e){return P(e,{},{})}function N(e){var r=e.$PS;if(r){var t=e.state;if(null===t)e.state=r;else for(var n in r)t[n]=r[n];e.$PS=null}e.$BR=!1}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,B(e,r)}function B(e,r){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},B(e,r)}var M=function(r){function t(e){var t;return(t=r.call(this)||this).collector=[1/0],t.promises=[],t.pushQueue=t.pushQueue.bind(_(t)),e&&t.renderVNodeToQueue(e,null,null),t}w(t,r);var o=t.prototype;return o._read=function(){setTimeout(this.pushQueue,0)},o.addToQueue=function(e,r){if(i(r))"string"===typeof e&&this.collector.length-1===0?this.push(e):"string"===typeof e&&"string"===typeof this.collector[this.collector.length-2]?this.collector[this.collector.length-2]+=e:this.collector.splice(-1,0,e);else{var t=this.promises[r].length-1;"string"===typeof this.promises[r][t]&&"string"===typeof e?this.promises[r][t]+=e:this.promises[r].push(e)}},o.pushQueue=function(){var e=this.collector[0];if("string"===typeof e)this.push(e),this.collector.shift();else if(e&&("object"===typeof e||s(e))&&s(e.then)){var r=this;e.then((function(e){var t;(t=r.collector).splice.apply(t,[0,1].concat(r.promises[e])),r.promises[e]=null,setTimeout(r.pushQueue,0)})),this.collector[0]=null}else e===1/0&&this.emit("end")},o.renderVNodeToQueue=function(r,t,o){var v=this,g=r.flags,y=r.type,x=r.props||e.EMPTY_OBJ,T=r.children;if((14&g)>0)if(4&g){var b,P=new y(x,t),C=Boolean(y.getDerivedStateFromProps);if(P.$BS=!1,P.$SSR=!0,d(P.getChildContext)||(b=P.getChildContext()),i(b)||(t=h(t,b)),P.props===e.EMPTY_OBJ&&(P.props=x),P.context=t,!C&&s(P.componentWillMount)&&(P.$BR=!0,P.componentWillMount(),N(P)),s(P.getInitialProps)){var _=P.getInitialProps(P.props,P.context);if(_){if(Promise.resolve(_)===_){var w=this.promises.push([])-1;return void this.addToQueue(_.then((function(e){"object"===typeof e&&(P.props=h(P.props,e));var r=P.render(P.props,P.state,P.context);return u(r)?v.addToQueue("\x3c!--!--\x3e",w):a(r)?v.addToQueue(m(r),w):c(r)?v.addToQueue(r+"",w):v.renderVNodeToQueue(r,P.context,w),setTimeout(v.pushQueue,0),w})),o)}P.props=h(P.props,_)}}C&&(P.state=F(P,x,P.state));var B=P.render(P.props,P.state,P.context);u(B)?this.addToQueue("\x3c!--!--\x3e",o):a(B)?this.addToQueue(m(B),o):c(B)?this.addToQueue(B+"",o):this.renderVNodeToQueue(B,t,o)}else{var M=S(r,t);u(M)?this.addToQueue("\x3c!--!--\x3e",o):a(M)?this.addToQueue(m(M),o):c(M)?this.addToQueue(M+"",o):this.renderVNodeToQueue(M,t,o)}else if((481&g)>0){var O,$="<"+y,R=k.has(y),D=r.className;if(a(D)?$+=' class="'+m(D)+'"':c(D)&&($+=' class="'+D+'"'),!l(x))for(var E in x){var V=x[E];switch(E){case"dangerouslySetInnerHTML":O=V.__html;break;case"style":i(x.style)||($+=' style="'+p(x.style)+'"');break;case"children":case"className":break;case"defaultValue":x.value||($+=' value="'+(a(V)?m(V):V)+'"');break;case"defaultChecked":x.checked||($+=' checked="'+V+'"');break;default:Q(E)&&(a(V)?$+=" "+E+'="'+m(V)+'"':c(V)?$+=" "+E+'="'+V+'"':!0===V&&($+=" "+E))}}if($+=">",String(y).match(/[\s\n\/='"\0<>]/))throw $;if(R)this.addToQueue($,o);else{var A=r.childFlags;if(2===A)return this.addToQueue($,o),this.renderVNodeToQueue(T,t,o),void this.addToQueue("</"+y+">",o);if(16===A)return this.addToQueue($,o),this.addToQueue(""===T?" ":m(T+""),o),void this.addToQueue("</"+y+">",o);if(12&A){this.addToQueue($,o);for(var j=0,I=T.length;j<I;++j)this.renderVNodeToQueue(T[j],t,o);return void this.addToQueue("</"+y+">",o)}if(O)return void this.addToQueue($+O+"</"+y+">",o);R||this.addToQueue($+"</"+y+">",o)}}else if((16&g)>0)this.addToQueue(""===T?" ":m(T),o);else if(n(r)||0!==(8192&g)){var W=r.childFlags;if(2===W||n(r)&&0===r.length)this.addToQueue("\x3c!--!--\x3e",o);else if(12&W||n(r)){for(var J=n(r)?r:r.children,Y=0,q=J.length;Y<q;++Y)this.renderVNodeToQueue(J[Y],t,o);return}}else f()},t}(r.Readable);function O(e){return new M(e)}function $(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,R(e,r)}function R(e,r){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},R(e,r)}var D=Promise.resolve(),E=function(e){function r(r){var t;return(t=e.call(this)||this).initNode=void 0,t.started=!1,t.initNode=r,t}$(r,e);var t=r.prototype;return t._read=function(){var e=this;if(this.started)return;this.started=!0,D.then((function(){return e.renderNode(e.initNode,null)})).then((function(){e.push(null)})).catch((function(r){e.emit("error",r)}))},t.renderNode=function(e,r){var t=e.flags;if((14&t)>0)return this.renderComponent(e,r,4&t);if((481&t)>0)return this.renderElement(e,r);if(n(e)||0!==(8192&t))return this.renderArrayOrFragment(e,r);return this.renderText(e)},t.renderArrayOrFragment=function(e,r){var t=this,o=e.childFlags;if(2===o||n(e)&&0===e.length)return this.push("\x3c!--!--\x3e");if(12&o||n(e))return(n(e)?e:e.children).reduce((function(e,n){return e.then((function(){return Promise.resolve(t.renderNode(n,r)).then((function(){return!!(16&n.flags)}))}))}),Promise.resolve(!1))},t.renderComponent=function(e,r,t){var n=this,o=e.type,l=e.props;if(!t){var d=S(e,r);if(u(d))return this.push("\x3c!--!--\x3e");if(a(d))return this.push(m(d));if(c(d))return this.push(d+"");return this.renderNode(d,r)}var f,p=new o(l,r),v=Boolean(o.getDerivedStateFromProps);return p.$BS=!1,p.$SSR=!0,s(p.getChildContext)&&(f=p.getChildContext()),i(f)||(r=h(r,f)),p.context=r,p.$BR=!0,Promise.resolve(!v&&p.componentWillMount&&p.componentWillMount()).then((function(){N(p),v&&(p.state=F(p,l,p.state));var e=p.render(p.props,p.state,p.context);if(u(e))return n.push("\x3c!--!--\x3e");if(a(e))return n.push(m(e));if(c(e))return n.push(e+"");return n.renderNode(e,r)}))},t.renderChildren=function(e,r,t){var n=this;if(2===t)return this.renderNode(e,r);if(16===t)return this.push(""===e?" ":m(e+""));if(12&t)return e.reduce((function(e,t){return e.then((function(){return Promise.resolve(n.renderNode(t,r)).then((function(){return!!(16&t.flags)}))}))}),Promise.resolve(!1))},t.renderText=function(e){this.push(""===e.children?" ":m(e.children))},t.renderElement=function(e,r){var t,n=this,o=e.type,u=e.props,s="<"+o,d=k.has(o),f=e.className;if(a(f)?s+=' class="'+m(f)+'"':c(f)&&(s+=' class="'+f+'"'),!l(u))for(var h in u){var v=u[h];switch(h){case"dangerouslySetInnerHTML":t=v.__html;break;case"style":i(u.style)||(s+=' style="'+p(u.style)+'"');break;case"children":case"className":break;case"defaultValue":u.value||(s+=' value="'+(a(v)?m(v):v)+'"');break;case"defaultChecked":u.checked||(s+=' checked="'+v+'"');break;default:if(Q(h)){a(v)?s+=" "+h+'="'+m(v)+'"':c(v)?s+=" "+h+'="'+v+'"':!0===v&&(s+=" "+h);break}}}if(s+=">",this.push(s),String(o).match(/[\s\n\/='"\0<>]/))throw s;if(d)return;if(t)return this.push(t),void this.push("</"+o+">");var g=e.childFlags;if(1===g)return void this.push("</"+o+">");return Promise.resolve(this.renderChildren(e.children,r,g)).then((function(){n.push("</"+o+">")}))},r}(r.Readable);function V(e){return new E(e)}exports.RenderQueueStream=M,exports.RenderStream=E,exports.renderToStaticMarkup=C,exports.renderToString=C,exports.streamAsStaticMarkup=V,exports.streamAsString=V,exports.streamQueueAsStaticMarkup=O,exports.streamQueueAsString=O;
